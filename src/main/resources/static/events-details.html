<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>EventBooking ‚Äî Event Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <style>
        :root{--accent1:#6366f1;--accent2:#ec4899;--muted:#94a3b8;}
        body{font-family:'Inter',sans-serif; background:#0f172a; color:white;}
        .glass{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);backdrop-filter:blur(10px); border-radius:16px;}
        .btn-accent{background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:black; font-weight:600;}
        .muted{color:var(--muted);}
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden">
<div id="vanta-bg-detail" class="absolute inset-0 -z-10"></div>

<header class="fixed top-5 left-0 right-0 z-40 px-6">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
        <a href="/" class="text-2xl font-extrabold" style="background-image:linear-gradient(90deg,var(--accent1),var(--accent2)); background-clip:text; color:transparent;">üéü EventBooking</a>
        <nav id="nav-links" class="flex items-center gap-3">
            <!-- Links injected dynamically -->
        </nav>
    </div>
</header>

<main class="pt-28 max-w-6xl mx-auto px-6 relative z-10">
    <a href="index.html" class="muted text-sm">‚Üê Back to Events</a>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-6">
        <div class="md:col-span-2">
            <div class="rounded-2xl overflow-hidden shadow-lg" data-aos="fade-right">
                <img id="event-image" src="" alt="event" class="w-full h-96 object-cover rounded-2xl">
            </div>

            <div class="mt-6 glass p-6 rounded-2xl" data-aos="fade-up">
                <h1 id="event-name" class="text-3xl font-bold mb-2">Event Name</h1>
                <p id="event-date-location" class="muted mb-4">Date ‚Ä¢ Location</p>
                <p id="event-description" class="text-gray-200 mb-6">Event description goes here...</p>

                <div class="flex gap-4">
                    <a id="select-seats-btn" href="#" class="px-6 py-3 btn-accent rounded-lg shadow-lg">Select Seats</a>
                    <a href="#share" class="px-6 py-3 glass rounded-lg">Share</a>
                </div>
            </div>
        </div>

        <aside class="space-y-4">
            <div class="glass p-5 rounded-2xl neon" data-aos="fade-left">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm muted">Starting From</div>
                        <div id="event-price" class="text-2xl font-bold">‚Çπ0</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm muted">Seats Left</div>
                        <div id="event-seats-left" class="text-lg font-semibold">0</div>
                    </div>
                </div>
                <div id="event-organizer" class="mt-4 text-sm muted">Organizer: </div>
            </div>

            <div class="glass p-5 rounded-2xl" data-aos="fade-left" data-aos-delay="120">
                <h4 class="font-semibold mb-2">Venue</h4>
                <div id="event-venue" class="text-gray-300 text-sm">Venue details</div>
            </div>
        </aside>
    </div>
</main>

<script>
    // VANTA background
    VANTA.NET({
      el: "#vanta-bg-detail",
      color: 0x3b82f6,
      backgroundColor: 0x071225,
      points: 12.0,
      maxDistance: 20.0,
      spacing: 20.0
    });

    document.addEventListener('DOMContentLoaded', ()=> AOS.init({ duration:700, once:true }));



    // Dynamic Login/Logout
    const nav = document.getElementById('nav-links');
    const userEmail = sessionStorage.getItem('userEmail');

    if(userEmail){
        nav.innerHTML = `
            <a href="/events" class="px-4 py-2 rounded-lg glass">Events</a>
            <span class="px-4 py-2 rounded-lg">${userEmail}</span>
            <a href="#" id="logoutBtn" class="px-4 py-2 rounded-lg">Logout</a>
        `;

        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('userEmail');
            localStorage.removeItem('userEmail');
            window.location.reload();
        });
    } else {
        nav.innerHTML = `
            <a href="index.html" class="px-4 py-2 rounded-lg glass">Events</a>
            <a href="login.html"  class="px-4 py-2 rounded-lg">Login</a>
        `;
    }

    // Fetch event ID from URL query ?id=123
    let eventId = new URLSearchParams(window.location.search).get("id");
    let eventData = null;

    async function loadEvent() {
      if (eventId) {
        try {
          const res = await fetch(`/events/${eventId}`);
          if (!res.ok) throw new Error("Failed to fetch event details");
          eventData = await res.json();
        } catch(err) {
          console.error("Error fetching event:", err);
        }
      } else {
        eventData = JSON.parse(localStorage.getItem("event") || "{}");
      }

      if (!eventData || Object.keys(eventData).length === 0) {
        alert("Event data not found");
        return;
      }

      const fallbackImage = '/uploads/base.jpg';
      document.getElementById('event-image').src = eventData.imageUrl ? eventData.imageUrl : fallbackImage;
      document.getElementById('event-name').innerText = eventData.name || 'Event Name';
      document.getElementById('event-date-location').innerText =
          `${eventData.localDate ? new Date(eventData.localDate).toDateString() : 'TBD'} ‚Ä¢ ${eventData.location || 'TBD'}`;
      document.getElementById('event-description').innerText = eventData.description || "Event description goes here...";
      document.getElementById('event-price').innerText = `‚Çπ${eventData.price || 0}`;
      document.getElementById('event-seats-left').innerText = eventData.availableSeats || 0;
      document.getElementById('event-venue').innerText = eventData.location || 'Venue details';
      document.getElementById('event-organizer').innerText = `Organizer: ${eventData.organizer || "TBD"}`;
      document.getElementById('select-seats-btn').href = `/seat-selection.html?id=${eventData.id}`;
    }

    loadEvent();
</script>
</body>
</html>
